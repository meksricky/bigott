<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Composition Wizard Form View -->
        <record id="view_composition_wizard_form" model="ir.ui.view">
            <field name="name">composition.wizard.form</field>
            <field name="model">composition.wizard</field>
            <field name="arch" type="xml">
                <form string="üß† Generate Gift Composition">
                    <sheet>
                        <div class="oe_title">
                            <h1 style="color: #875A7B; text-align: center;">
                                üéÅ Se√±or Bigott AI Composition Generator
                            </h1>
                            <p style="text-align: center; font-size: 14px; color: #666;">
                                Generate personalized gift compositions using advanced AI analysis
                            </p>
                        </div>
                        
                        <group>
                            <group name="client_selection" string="üìã Client &amp; Budget">
                                <field name="partner_id" 
                                       placeholder="Select client..."
                                       domain="[('is_company', '=', False)]"
                                       options="{'no_create': True}"/>
                                <!-- ADDED: Show partner's dietary restrictions -->
                                <field name="partner_dietary_restrictions" readonly="1" 
                                       attrs="{'invisible': [('partner_id', '=', False)]}"
                                       string="Client's Dietary Profile"/>
                                <field name="target_year"/>
                                <field name="target_budget" widget="monetary"/>
                            </group>
                            <group name="composition_preferences" string="‚öôÔ∏è Preferences">
                                <field name="force_composition_type" widget="radio"/>
                                <field name="dietary_restrictions"/>
                                <field name="additional_notes" 
                                       placeholder="Any special notes for this recommendation? (e.g., 'Client loves premium wines', 'Prefers traditional Spanish products', 'Budget flexible for quality')"/>
                            </group>
                        </group>
                        
                        <!-- FIXED: Dynamic Client Information Display using computed field -->
                        <div attrs="{'invisible': [('partner_id', '=', False)]}" style="margin-top: 20px;">
                            <!-- Use the computed client_info field instead of static data -->
                            <field name="client_info" nolabel="1"/>
                        </div>
                        
                        <!-- ADDED: Dynamic AI Recommendations using computed fields -->
                        <div attrs="{'invisible': [('partner_id', '=', False)]}" style="margin-top: 20px;">
                            <div class="alert alert-success" role="alert" style="border-left: 4px solid #28a745;">
                                <h5 style="color: #155724; margin-bottom: 15px;">
                                    ü§ñ Se√±or Bigott Live Analysis
                                </h5>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div style="margin-bottom: 12px;">
                                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                                <i class="fa fa-lightbulb text-warning" style="margin-right: 8px;"/>
                                                <strong style="color: #155724;">Budget Strategy:</strong>
                                            </div>
                                            <div style="background: #d4edda; padding: 8px 12px; border-radius: 6px; border: 1px solid #c3e6cb;">
                                                <field name="budget_recommendation" readonly="1" nolabel="1" 
                                                       style="color: #155724; font-weight: 500;"/>
                                            </div>
                                        </div>
                                        
                                        <div style="margin-bottom: 12px;">
                                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                                <i class="fa fa-bullseye text-primary" style="margin-right: 8px;"/>
                                                <strong style="color: #155724;">Recommended Approach:</strong>
                                            </div>
                                            <div style="background: #d4edda; padding: 8px 12px; border-radius: 6px; border: 1px solid #c3e6cb;">
                                                <field name="approach_recommendation" readonly="1" nolabel="1"
                                                       style="color: #155724; font-weight: 500;"/>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div style="margin-bottom: 12px;">
                                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                                <i class="fa fa-shield-alt text-info" style="margin-right: 8px;"/>
                                                <strong style="color: #155724;">Risk Assessment:</strong>
                                            </div>
                                            <div style="background: #d4edda; padding: 8px 12px; border-radius: 6px; border: 1px solid #c3e6cb;">
                                                <field name="risk_level" widget="badge" readonly="1" nolabel="1"
                                                       decoration-success="risk_level == 'low'"
                                                       decoration-warning="risk_level == 'medium'"
                                                       decoration-danger="risk_level == 'high'"/>
                                                <div style="margin-top: 8px; font-size: 12px; color: #6c757d;">
                                                    <span attrs="{'invisible': [('risk_level', '!=', 'low')]}">
                                                        ‚úÖ High confidence - Strong historical data available
                                                    </span>
                                                    <span attrs="{'invisible': [('risk_level', '!=', 'medium')]}">
                                                        ‚ö†Ô∏è Medium confidence - Some historical data available
                                                    </span>
                                                    <span attrs="{'invisible': [('risk_level', '!=', 'high')]}">
                                                        üîÑ Limited data - Using industry best practices
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="margin-bottom: 0;">
                                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                                <i class="fa fa-utensils text-info" style="margin-right: 8px;"/>
                                                <strong style="color: #155724;">AI Features Active:</strong>
                                            </div>
                                            <div style="background: #d4edda; padding: 8px 12px; border-radius: 6px; border: 1px solid #c3e6cb;">
                                                <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: #155724;">
                                                    <li>Historical pattern analysis</li>
                                                    <li>Notes sentiment processing</li>
                                                    <li>Dynamic budget optimization</li>
                                                    <li>Dietary preference matching</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Warning for high-risk clients -->
                        <div attrs="{'invisible': ['|', ('partner_id', '=', False), ('risk_level', '!=', 'high')]}" 
                             class="alert alert-warning" role="alert" style="margin-top: 15px;">
                            <div style="display: flex; align-items: center;">
                                <i class="fa fa-info-circle" style="font-size: 20px; margin-right: 12px; color: #856404;"/>
                                <div>
                                    <strong>New Client Advisory</strong><br/>
                                    <small>Limited purchase history available. Consider adding detailed notes above to help the AI generate better recommendations.</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Enhanced call-to-action for generation -->
                        <div attrs="{'invisible': [('partner_id', '=', False)]}" 
                             style="background: linear-gradient(135deg, #875A7B 0%, #6f4c6b 100%); 
                                    color: white; padding: 20px; border-radius: 12px; text-align: center; margin: 20px 0;">
                            <i class="fa fa-robot" style="font-size: 28px; margin-bottom: 10px;"/>
                            <h5 style="color: white; margin-bottom: 8px;">Ready to Generate AI Composition?</h5>
                            <p style="color: rgba(255,255,255,0.9); margin: 0; font-size: 13px;">
                                The AI will analyze client history, preferences, notes, and market data to create the perfect gift
                            </p>
                        </div>
                        
                    </sheet>
                    <footer>
                        <button name="action_generate_composition" 
                                string="üöÄ Generate AI Composition" 
                                type="object" 
                                class="btn-primary btn-lg"
                                data-hotkey="q"
                                style="min-width: 200px; background: linear-gradient(135deg, #875A7B 0%, #6f4c6b 100%); border: none;"
                                attrs="{'invisible': [('partner_id', '=', False)]}"/>
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                        
                        <!-- Help text -->
                        <div class="float-right" style="color: #6c757d; font-size: 12px; margin-top: 8px;"
                             attrs="{'invisible': [('partner_id', '!=', False)]}">
                            <i class="fa fa-arrow-up"/> Select a client above to begin AI analysis
                        </div>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Composition Wizard Action -->
        <record id="action_composition_wizard" model="ir.actions.act_window">
            <field name="name">üß† Generate New Composition</field>
            <field name="res_model">composition.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{}</field>
        </record>
        
    </data>
</odoo>