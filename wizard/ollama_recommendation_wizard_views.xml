<?xml version="1.0" encoding="utf-8"?>
<!-- wizard/ollama_recommendation_wizard_views.xml -->
<odoo>
    <data>
        
        <!-- Enhanced Wizard Form View -->
        <record id="view_ollama_recommendation_wizard_form" model="ir.ui.view">
            <field name="name">ollama.recommendation.wizard.form.enhanced</field>
            <field name="model">ollama.recommendation.wizard</field>
            <field name="arch" type="xml">
                <form string="üéÅ Gift Recommendation Generator">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="draft,generating,done"/>
                    </header>
                    
                    <sheet>
                        <!-- Composition Type Display -->
                        <div class="alert alert-info" attrs="{'invisible': [('state', '!=', 'done')]}">
                            <h4 style="margin: 0;">
                                <field name="composition_display_type" readonly="1" nolabel="1" style="font-weight: bold;"/>
                                <span attrs="{'invisible': [('composition_id', '=', False)]}">
                                    - Composition Generated Successfully!
                                </span>
                            </h4>
                        </div>
                        
                        <group col="2">
                            <!-- Left Column: Client Information -->
                            <group string="Client Information">
                                <field name="partner_id" options="{'no_create': True, 'no_open': False}"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="target_budget" widget="monetary"/>
                                <field name="target_year"/>
                            </group>
                            
                            <!-- Right Column: Composition Settings -->
                            <group string="Composition Settings">
                                <field name="engine_type" widget="radio" options="{'horizontal': true}"/>
                                <field name="experience_category_filter" 
                                       attrs="{'invisible': [('engine_type', 'not in', ['experience', 'hybrid'])]}"/>
                                <field name="selected_experience"
                                       widget="selection"
                                       attrs="{'invisible': [('engine_type', 'not in', ['experience', 'hybrid'])],
                                              'required': [('engine_type', 'in', ['experience', 'hybrid'])]}"/>
                            </group>
                        </group>
                        
                        <!-- Experience Preview -->
                        <group attrs="{'invisible': [('experience_preview', '=', False)]}" col="1">
                            <separator string="üì¶ Experience Details"/>
                            <field name="experience_preview" widget="html" nolabel="1" readonly="1"/>
                        </group>
                        
                        <!-- Dietary Restrictions Section -->
                        <group string="Dietary Restrictions &amp; Notes" col="2">
                            <group>
                                <field name="dietary_restrictions" widget="selection"/>
                                <field name="dietary_restrictions_text" 
                                       placeholder="Enter multiple restrictions separated by commas..."
                                       attrs="{'invisible': [('dietary_restrictions', '!=', 'multiple')],
                                              'required': [('dietary_restrictions', '=', 'multiple')]}"/>
                                <field name="client_dietary_history" 
                                       attrs="{'invisible': [('partner_id', '=', False)]}"
                                       readonly="1"
                                       style="font-style: italic; color: #666;"/>
                            </group>
                            <group>
                                <field name="client_notes" 
                                       placeholder="Any special requests or preferences..."
                                       widget="text"/>
                                <!-- Legacy checkboxes (hidden but functional) -->
                                <field name="is_vegan" invisible="1"/>
                                <field name="is_halal" invisible="1"/>
                                <field name="is_gluten_free" invisible="1"/>
                                <field name="is_non_alcoholic" invisible="1"/>
                            </group>
                        </group>
                        
                        <!-- Client Profile Display -->
                        <group string="Client Profile" attrs="{'invisible': [('partner_id', '=', False)]}" col="1">
                            <field name="client_info" widget="html" nolabel="1" readonly="1"/>
                        </group>
                        
                        <!-- Results Section -->
                        <group string="Generation Results" attrs="{'invisible': [('state', '!=', 'done')]}" col="1">
                            <field name="result_message" widget="html" nolabel="1" readonly="1"/>
                            
                            <group col="4">
                                <field name="total_cost" widget="monetary" readonly="1"/>
                                <field name="confidence_score" widget="percentage" readonly="1"/>
                                <field name="composition_id" readonly="1" invisible="1"/>
                                <newline/>
                                <button name="action_view_composition" 
                                        type="object" 
                                        string="üìÑ View Full Composition" 
                                        class="btn-primary"
                                        attrs="{'invisible': [('composition_id', '=', False)]}"/>
                            </group>
                        </group>

                        <group string="Composition Details">
                            <field name="composition_type" widget="radio" 
                                help="Custom: Mixed products | Hybrid: Wine-focused | Experience: Activity-focused"/>
                            <field name="specify_product_count"/>
                            <field name="product_count" 
                                attrs="{'invisible': [('specify_product_count', '=', False)], 
                                        'required': [('specify_product_count', '=', True)]}"/>
                        </group>
                        
                        <!-- Recommended Products -->
                        <notebook attrs="{'invisible': [('state', '!=', 'done')]}">
                            <page string="üì¶ All Products">
                                <field name="recommended_products" readonly="1">
                                    <tree string="Recommended Products" create="false" delete="false">
                                        <field name="name"/>
                                        <field name="default_code" string="Reference"/>
                                        <field name="categ_id" string="Category"/>
                                        <field name="list_price" widget="monetary" string="Price"/>
                                        <field name="qty_available" string="Stock"/>
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer">
                                    <field name="total_cost" widget="monetary" class="oe_subtotal_footer_separator"/>
                                </group>
                            </page>
                        </notebook>
                        
                        <!-- Error Display -->
                        <group attrs="{'invisible': [('state', '!=', 'error')]}" col="1">
                            <div class="alert alert-danger">
                                <strong>‚ö†Ô∏è Error:</strong>
                                <field name="error_message" readonly="1" nolabel="1"/>
                            </div>
                        </group>
                        
                        <!-- Advanced Settings -->
                        <group string="Advanced Settings" groups="base.group_system" col="2">
                            <field name="recommender_id"/>
                        </group>
                    </sheet>
                    
                    <footer>
                        <button name="action_generate_recommendation" 
                                type="object" 
                                string="üéØ Generate Recommendation" 
                                class="btn-primary"
                                attrs="{'invisible': ['|', ('state', '=', 'generating'), ('state', '=', 'done')]}"/>
                        
                        <button name="action_generate_another" 
                                type="object" 
                                string="üîÑ Generate Another" 
                                class="btn-secondary"
                                attrs="{'invisible': [('state', '!=', 'done')]}"/>
                        
                        <button name="action_test_connection" 
                                type="object" 
                                string="üîå Test Connection" 
                                class="btn-secondary"
                                attrs="{'invisible': [('state', '!=', 'draft')]}"
                                groups="base.group_system"/>
                        
                        <button string="Cancel" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Wizard Action -->
        <record id="action_ollama_recommendation_wizard" model="ir.actions.act_window">
            <field name="name">Generate Gift Recommendation</field>
            <field name="res_model">ollama.recommendation.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{'default_engine_type': 'custom'}</field>
        </record>
        
        <!-- Menu Item (optional - add if you want it in menu) -->
        <menuitem id="menu_ollama_recommendation_wizard"
                  name="üéÅ Generate Recommendation"
                  action="action_ollama_recommendation_wizard"
                  parent="sale.sale_order_menu"
                  sequence="100"
                  groups="base.group_user"/>
        
    </data>
</odoo>