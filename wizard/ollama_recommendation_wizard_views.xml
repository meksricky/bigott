<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Ollama Recommendation Wizard Form View -->
        <record id="view_ollama_recommendation_wizard_form" model="ir.ui.view">
            <field name="name">ollama.recommendation.wizard.form</field>
            <field name="model">ollama.recommendation.wizard</field>
            <field name="arch" type="xml">
                <form string="🎁 AI Gift Composition Generator">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="draft,generating,done"/>
                    </header>
                    <sheet>
                        <!-- Title Section -->
                        <div class="oe_title">
                            <h1 style="color: #875A7B;">
                                <i class="fa fa-robot"/> AI Gift Recommendation Wizard
                            </h1>
                            <field name="ollama_status" nolabel="1"/>
                        </div>
                        
                        <!-- Main Content in Tabs -->
                        <notebook>
                            <!-- Tab 1: Client & Budget -->
                            <page string="Client & Budget" name="client_budget">
                                <group>
                                    <group name="client_section" string="Client Selection">
                                        <field name="partner_id" 
                                               options="{'no_create': True, 'no_open': True}"
                                               placeholder="Select client..."/>
                                        <field name="expected_strategy" 
                                               attrs="{'invisible': [('partner_id', '=', False)]}"
                                               readonly="1"/>
                                    </group>
                                    <group name="budget_section" string="Budget Configuration">
                                        <field name="target_budget" widget="monetary"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="target_year"/>
                                        <field name="business_rules_applicable" 
                                               widget="boolean_toggle"
                                               readonly="1"
                                               attrs="{'invisible': [('partner_id', '=', False)]}"/>
                                    </group>
                                </group>
                                
                                <!-- Dynamic Client Information -->
                                <separator string="Client Analysis" attrs="{'invisible': [('partner_id', '=', False)]}"/>
                                <div attrs="{'invisible': [('partner_id', '=', False)]}">
                                    <field name="client_info" nolabel="1" readonly="1"/>
                                </div>
                                
                                <!-- AI Recommendations Panel -->
                                <separator string="AI Recommendations" attrs="{'invisible': [('partner_id', '=', False)]}"/>
                                <group attrs="{'invisible': [('partner_id', '=', False)]}" col="4">
                                    <field name="budget_recommendation" readonly="1"/>
                                    <field name="approach_recommendation" readonly="1"/>
                                    <field name="risk_level" widget="badge" readonly="1"
                                           decoration-success="risk_level == 'low'"
                                           decoration-warning="risk_level == 'medium'"
                                           decoration-danger="risk_level == 'high'"/>
                                    <field name="has_previous_orders" invisible="1"/>
                                    <field name="has_last_year_data" invisible="1"/>
                                </group>
                            </page>
                            
                            <!-- Tab 2: Composition Settings -->
                            <page string="Composition" name="composition_settings">
                                <group>
                                    <group string="Composition Type">
                                        <field name="force_composition_type" widget="radio"/>
                                        <field name="composition_type" 
                                               attrs="{'invisible': [('force_composition_type', '!=', 'auto')], 
                                                      'readonly': [('force_composition_type', '!=', 'auto')]}"/>
                                        <field name="engine_type" invisible="1"/>
                                    </group>
                                    <group string="Product Configuration">
                                        <field name="specify_product_count"/>
                                        <field name="product_count" 
                                               attrs="{'invisible': [('specify_product_count', '=', False)],
                                                      'required': [('specify_product_count', '=', True)]}"/>
                                    </group>
                                </group>
                                
                                <!-- Experience Selection (conditional) -->
                                <group string="Experience Selection" 
                                       attrs="{'invisible': ['|', 
                                              ('force_composition_type', '!=', 'experience'),
                                              ('composition_type', '!=', 'experience')]}">
                                    <field name="experience_category_filter"/>
                                    <field name="selected_experience" 
                                           attrs="{'invisible': [('experience_category_filter', '=', 'all')]}"/>
                                    <field name="experience_preview" 
                                           nolabel="1" 
                                           colspan="2"
                                           attrs="{'invisible': [('selected_experience', '=', False)]}"/>
                                </group>
                            </page>
                            
                            <!-- Tab 3: Dietary & Preferences -->
                            <page string="Dietary & Preferences" name="dietary_prefs">
                                <group>
                                    <group string="Dietary Restrictions">
                                        <field name="dietary_restrictions" widget="radio"/>
                                        <field name="dietary_restrictions_text" 
                                               placeholder="Enter additional restrictions..."
                                               attrs="{'invisible': [('dietary_restrictions', '!=', 'multiple')]}"/>
                                    </group>
                                    <group string="Detailed Options">
                                        <field name="is_halal"/>
                                        <field name="is_vegan"/>
                                        <field name="is_vegetarian"/>
                                        <field name="is_gluten_free"/>
                                        <field name="is_non_alcoholic"/>
                                    </group>
                                </group>
                                
                                <!-- Client Dietary History -->
                                <group string="Client History" attrs="{'invisible': [('partner_id', '=', False)]}">
                                    <field name="partner_dietary_restrictions" readonly="1" nolabel="1"/>
                                    <field name="client_dietary_history" readonly="1" nolabel="1"/>
                                </group>
                            </page>
                            
                            <!-- Tab 4: Notes & Context -->
                            <page string="Notes & Instructions" name="notes">
                                <group>
                                    <field name="client_notes" 
                                           nolabel="1"
                                           placeholder="Enter any special requirements, preferences, or instructions...&#10;&#10;Examples:&#10;• 'Client loves Spanish wines and artisanal cheeses'&#10;• 'Budget flexible up to €1500 for exceptional items'&#10;• 'Include exactly 15 products'&#10;• 'No chocolates or nuts (allergy)'&#10;• 'Prefers traditional products over modern'"
                                           style="min-height: 150px;"/>
                                </group>
                                <div class="alert alert-info" role="alert">
                                    <i class="fa fa-info-circle"/> <b>Note:</b> Information in this field takes precedence over other settings.
                                    The AI will intelligently parse your notes to extract budget, product count, and preferences.
                                </div>
                            </page>
                            
                            <!-- Tab 5: History Analysis -->
                            <page string="History Analysis" name="history" 
                                  attrs="{'invisible': [('partner_id', '=', False)]}">
                                <field name="client_history_summary" nolabel="1" readonly="1"/>
                            </page>
                            
                            <!-- Tab 6: Results (shown after generation) -->
                            <page string="Results" name="results" 
                                  attrs="{'invisible': [('state', 'not in', ['done', 'error'])]}">
                                <group attrs="{'invisible': [('state', '!=', 'done')]}">
                                    <field name="composition_id" readonly="1"/>
                                    <field name="confidence_score" widget="percentage" readonly="1"/>
                                    <field name="total_cost" widget="monetary" readonly="1"/>
                                    <field name="product_count_actual" readonly="1"/>
                                </group>
                                
                                <separator string="Result Details"/>
                                <field name="result_message" 
                                       nolabel="1" 
                                       readonly="1"
                                       attrs="{'invisible': [('state', '!=', 'done')]}"/>
                                <field name="error_message" 
                                       nolabel="1" 
                                       readonly="1"
                                       attrs="{'invisible': [('state', '!=', 'error')]}"/>
                                
                                <separator string="Generated Products" 
                                          attrs="{'invisible': [('recommended_products', '=', [])]}"/>
                                <field name="recommended_products" 
                                       readonly="1"
                                       attrs="{'invisible': [('recommended_products', '=', [])]}"
                                       context="{'tree_view_ref': 'product.product_template_tree_view'}">
                                    <tree>
                                        <field name="default_code"/>
                                        <field name="name"/>
                                        <field name="categ_id"/>
                                        <field name="list_price" widget="monetary"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    
                    <!-- Footer Buttons -->
                    <footer>
                        <!-- Main action buttons -->
                        <button name="action_generate_recommendation" 
                                string="🚀 Generate Composition" 
                                type="object" 
                                class="btn-primary"
                                attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('partner_id', '=', False)]}"
                                data-hotkey="q"/>
                        
                        <button name="action_view_composition" 
                                string="📄 View Composition" 
                                type="object" 
                                class="btn-success"
                                attrs="{'invisible': [('composition_id', '=', False)]}"/>
                        
                        <button name="action_generate_another" 
                                string="🔄 Generate Another" 
                                type="object" 
                                class="btn-secondary"
                                attrs="{'invisible': [('state', '!=', 'done')]}"/>
                        
                        <!-- Utility buttons -->
                        <button name="action_test_connection" 
                                string="🔌 Test Ollama" 
                                type="object" 
                                class="btn-info"
                                attrs="{'invisible': [('state', 'not in', ['draft', 'error'])]}"/>
                        
                        <button string="Close" 
                                class="btn-secondary" 
                                special="cancel"/>
                        
                        <!-- State indicator -->
                        <div class="text-muted float-left" 
                             attrs="{'invisible': [('partner_id', '!=', False)]}">
                            <i class="fa fa-arrow-up"/> Select a client to begin
                        </div>
                    </footer>
                </form>
            </field>
        </record>
        
        <!-- Ollama Recommendation Wizard Action -->
        <record id="action_ollama_recommendation_wizard" model="ir.actions.act_window">
            <field name="name">🎁 AI Gift Recommendation</field>
            <field name="res_model">ollama.recommendation.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{}</field>
        </record>
        
        <!-- Add Menu Item -->
        <menuitem id="menu_ollama_recommendation_wizard"
                  name="AI Recommendations"
                  parent="sale.sale_order_menu"
                  action="action_ollama_recommendation_wizard"
                  sequence="100"/>
        
    </data>
</odoo>