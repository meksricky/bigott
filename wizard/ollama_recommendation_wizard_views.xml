<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Main Wizard View -->
    <record id="view_ollama_recommendation_wizard_form" model="ir.ui.view">
        <field name="name">ollama.recommendation.wizard.form</field>
        <field name="model">ollama.recommendation.wizard</field>
        <field name="arch" type="xml">
            <form string="ðŸŽ Gift Recommendation Wizard">
                <header>
                    <!-- Step indicators -->
                    <field name="wizard_step" widget="statusbar" 
                           statusbar_visible="client,budget,composition,dietary,preview" 
                           clickable="1"/>
                </header>
                
                <sheet>
                    <!-- AI Status Banner -->
                    <div class="alert alert-info" attrs="{'invisible': [('ai_status', '=', False)]}">
                        <field name="ai_status" nolabel="1"/>
                    </div>
                    
                    <!-- Main Content Area -->
                    <group>
                        <!-- Step 1: Client Selection -->
                        <group attrs="{'invisible': [('wizard_step', '!=', 'client')]}" colspan="4">
                            <div class="oe_title" style="margin-bottom: 20px;">
                                <h1>
                                    <span class="text-primary">Step 1: Select Client</span>
                                </h1>
                                <p class="text-muted">Choose the client and review their history</p>
                            </div>
                            
                            <group col="2">
                                <group>
                                    <field name="partner_id" options="{'no_create': True, 'no_open': True}"/>
                                    <field name="client_segment" widget="badge"/>
                                    <field name="target_year"/>
                                </group>
                                <group>
                                    <div class="o_td_label">
                                        <label for="client_preferences" string="Client Insights"/>
                                    </div>
                                    <div class="alert alert-light">
                                        <field name="client_preferences" nolabel="1"/>
                                    </div>
                                </group>
                            </group>
                        </group>
                        
                        <!-- Step 2: Budget & Requirements -->
                        <group attrs="{'invisible': [('wizard_step', '!=', 'budget')]}" colspan="4">
                            <div class="oe_title" style="margin-bottom: 20px;">
                                <h1>
                                    <span class="text-primary">Step 2: Set Budget & Requirements</span>
                                </h1>
                                <p class="text-muted">Define budget constraints and product requirements</p>
                            </div>
                            
                            <group col="2">
                                <group string="ðŸ’° Budget Settings">
                                    <field name="budget_source" widget="radio_horizontal"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="target_budget" widget="monetary" 
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="budget_flexibility" widget="selection_badge"/>
                                </group>
                                
                                <group string="ðŸ“¦ Product Count">
                                    <field name="product_count_mode" widget="radio"/>
                                    <field name="product_count_exact" 
                                           attrs="{'invisible': [('product_count_mode', '!=', 'exact')], 
                                                  'required': [('product_count_mode', '=', 'exact')]}"/>
                                    <div attrs="{'invisible': [('product_count_mode', '!=', 'range')]}">
                                        <label for="product_count_min" string="Range"/>
                                        <div class="o_row">
                                            <field name="product_count_min" style="width: 60px;"/>
                                            <span> to </span>
                                            <field name="product_count_max" style="width: 60px;"/>
                                            <span> products</span>
                                        </div>
                                    </div>
                                </group>
                            </group>
                        </group>
                        
                        <!-- Step 3: Composition Type -->
                        <group attrs="{'invisible': [('wizard_step', '!=', 'composition')]}" colspan="4">
                            <div class="oe_title" style="margin-bottom: 20px;">
                                <h1>
                                    <span class="text-primary">Step 3: Choose Composition Strategy</span>
                                </h1>
                                <p class="text-muted">Select how the gift should be composed</p>
                            </div>
                            
                            <field name="composition_strategy" widget="radio" class="o_light_label"/>
                            
                            <!-- Experience Options -->
                            <group attrs="{'invisible': [('composition_strategy', '!=', 'experience')]}" 
                                   string="ðŸŽ­ Experience Selection" col="2">
                                <field name="experience_category" widget="selection_badge"/>
                                <field name="selected_experience_key" 
                                       attrs="{'invisible': [('experience_category', '=', False)]}"/>
                                <separator string="Or choose a custom experience" colspan="2"/>
                                <field name="custom_experience_id" 
                                       options="{'no_create': True}"
                                       colspan="2"/>
                            </group>
                            
                            <!-- Theme Options -->
                            <group attrs="{'invisible': [('composition_strategy', '!=', 'themed')]}"
                                   string="ðŸŽª Theme Selection">
                                <field name="gift_theme" widget="selection_badge"/>
                            </group>
                            
                            <!-- Category Preferences -->
                            <group string="ðŸ“‹ Category Preferences" col="4">
                                <field name="include_wine" widget="boolean_toggle"/>
                                <field name="include_spirits" widget="boolean_toggle"/>
                                <field name="include_gourmet" widget="boolean_toggle"/>
                                <field name="include_sweets" widget="boolean_toggle"/>
                                <field name="include_experiences" widget="boolean_toggle"/>
                            </group>
                        </group>
                        
                        <!-- Step 4: Dietary & Preferences -->
                        <group attrs="{'invisible': [('wizard_step', '!=', 'dietary')]}" colspan="4">
                            <div class="oe_title" style="margin-bottom: 20px;">
                                <h1>
                                    <span class="text-primary">Step 4: Dietary Restrictions & Preferences</span>
                                </h1>
                                <p class="text-muted">Specify any dietary requirements or special preferences</p>
                            </div>
                            
                            <group col="2">
                                <group string="ðŸ½ï¸ Dietary Profile">
                                    <field name="dietary_profile" widget="radio"/>
                                    <field name="dietary_details" 
                                           attrs="{'invisible': [('dietary_profile', 'not in', ['custom', 'halal', 'vegan', 'vegetarian'])],
                                                  'required': [('dietary_profile', '=', 'custom')]}"
                                           placeholder="E.g., no nuts, lactose-free, kosher..."/>
                                </group>
                                
                                <group string="ðŸ“ Additional Context">
                                    <field name="occasion_notes" 
                                           placeholder="Birthday celebration, corporate event, holiday gift..."
                                           widget="text" 
                                           style="min-height: 100px;"/>
                                </group>
                            </group>
                        </group>
                        
                        <!-- Step 5: Preview & Generate -->
                        <group attrs="{'invisible': [('wizard_step', '!=', 'preview')]}" colspan="4">
                            <div class="oe_title" style="margin-bottom: 20px;">
                                <h1>
                                    <span class="text-primary">Step 5: Preview & Generate</span>
                                </h1>
                                <p class="text-muted">Review and generate your gift composition</p>
                            </div>
                            
                            <!-- Summary Card -->
                            <div class="card mb-3" style="background: #f8f9fa;">
                                <div class="card-body">
                                    <h4 class="card-title">ðŸ“‹ Configuration Summary</h4>
                                    <table class="table table-sm table-borderless">
                                        <tr>
                                            <td width="30%"><b>Client:</b></td>
                                            <td><field name="partner_id" readonly="1" nolabel="1"/></td>
                                        </tr>
                                        <tr>
                                            <td><b>Budget:</b></td>
                                            <td>
                                                <field name="currency_id" invisible="1"/>
                                                <field name="target_budget" readonly="1" nolabel="1" 
                                                       widget="monetary" 
                                                       options="{'currency_field': 'currency_id'}"/>
                                                (<field name="budget_flexibility" readonly="1" nolabel="1"/>)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><b>Strategy:</b></td>
                                            <td><field name="composition_strategy" readonly="1" nolabel="1"/></td>
                                        </tr>
                                        <tr>
                                            <td><b>Products:</b></td>
                                            <td><span t-esc="_get_product_count_display()"/></td>
                                        </tr>
                                        <tr>
                                            <td><b>Dietary:</b></td>
                                            <td><field name="dietary_profile" readonly="1" nolabel="1"/></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Preview Area -->
                            <div attrs="{'invisible': [('preview_generated', '=', False)]}">
                                <separator string="ðŸŽ Composition Preview"/>
                                <field name="preview_html" nolabel="1" readonly="1"/>
                                
                                <group col="4" class="mt-3">
                                    <field name="preview_total" widget="monetary" 
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="preview_confidence" widget="percentage"/>
                                </group>
                            </div>
                            
                            <!-- Result Message -->
                            <div attrs="{'invisible': [('state', '!=', 'done')]}">
                                <field name="result_message" nolabel="1" readonly="1"/>
                            </div>
                        </group>
                    </group>
                </sheet>
                
                <!-- Footer Actions -->
                <footer>
                    <!-- Navigation buttons -->
                    <button name="action_previous_step" 
                            type="object" 
                            string="â† Previous" 
                            class="btn-secondary"
                            attrs="{'invisible': [('wizard_step', '=', 'client')]}"/>
                    
                    <button name="action_next_step" 
                            type="object" 
                            string="Next â†’" 
                            class="btn-primary"
                            attrs="{'invisible': ['|', ('wizard_step', '=', 'preview'), ('partner_id', '=', False)]}"/>
                    
                    <!-- Preview button -->
                    <button name="action_generate_preview" 
                            type="object" 
                            string="ðŸ” Generate Preview" 
                            class="btn-info"
                            attrs="{'invisible': ['|', ('wizard_step', '!=', 'preview'), ('preview_generated', '=', True)]}"/>
                    
                    <!-- Generate button -->
                    <button name="action_generate_composition" 
                            type="object" 
                            string="âœ¨ Generate Composition" 
                            class="btn-success"
                            attrs="{'invisible': ['|', ('wizard_step', '!=', 'preview'), ('preview_generated', '=', False)]}"/>
                    
                    <!-- Utility buttons -->
                    <button name="action_reset_wizard" 
                            type="object" 
                            string="â†º Reset" 
                            class="btn-warning"
                            attrs="{'invisible': [('state', 'not in', ['error', 'done'])]}"/>
                    
                    <button name="action_test_ai_connection" 
                            type="object" 
                            string="ðŸ”Œ Test AI" 
                            class="btn-secondary"/>
                    
                    <!-- Cancel button -->
                    <button string="Cancel" 
                            class="btn-secondary" 
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    
    <!-- Action -->
    <record id="action_ollama_recommendation_wizard" model="ir.actions.act_window">
        <field name="name">Gift Recommendation Wizard</field>
        <field name="res_model">ollama.recommendation.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_ollama_recommendation_wizard_form"/>
    </record>
    
    <!-- Menu Item -->
    <menuitem id="menu_ollama_recommendation_wizard" 
              name="ðŸŽ Gift Wizard" 
              parent="gift_manager.menu_gift_root"
              action="action_ollama_recommendation_wizard" 
              sequence="1"/>
    
    <!-- Additional CSS for better styling -->
    <template id="assets_backend" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <style>
                .o_ollama_wizard .o_form_sheet {
                    max-width: 1200px;
                }
                
                .o_ollama_wizard .card {
                    border: 1px solid rgba(0,0,0,0.125);
                    border-radius: 0.25rem;
                    margin-bottom: 1rem;
                }
                
                .o_ollama_wizard .card-body {
                    padding: 1.25rem;
                }
                
                .o_ollama_wizard .alert-light {
                    background-color: #f8f9fa;
                    border-color: #dee2e6;
                }
                
                .o_ollama_wizard .o_statusbar_status {
                    font-weight: bold;
                }
                
                .o_ollama_wizard .text-primary {
                    color: #007bff !important;
                }
                
                .o_ollama_wizard .text-muted {
                    color: #6c757d !important;
                }
                
                .o_ollama_wizard .btn-success {
                    background-color: #28a745;
                    border-color: #28a745;
                }
                
                .o_ollama_wizard .btn-info {
                    background-color: #17a2b8;
                    border-color: #17a2b8;
                }
                
                .o_ollama_wizard .btn-warning {
                    background-color: #ffc107;
                    border-color: #ffc107;
                    color: #212529;
                }
                
                .o_ollama_wizard .o_td_label {
                    vertical-align: top;
                    padding-top: 0.5rem;
                }
            </style>
        </xpath>
    </template>
</odoo>